



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-4.6.3">
    
    
      
        <title>yolo原理 - PurpleCypress</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#e91e63">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,400,400i,700%7CFira+Mono&display=fallback">
        <style>body,input{font-family:"Fira Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="pink" data-md-color-accent="cyan">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#yolo" tabindex="0" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="PurpleCypress" aria-label="PurpleCypress" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              PurpleCypress
            </span>
            <span class="md-header-nav__topic">
              
                yolo原理
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." class="md-tabs__link">
          简介
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../CSAPP/CSAPP-PartZero/" class="md-tabs__link">
          CSAPP
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Network/ComputerNetwork/" class="md-tabs__link">
          Computer Network
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../English/speaking/" class="md-tabs__link">
          English
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Forensics/image/" class="md-tabs__link">
          Forensics
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Linux/Linux/" class="md-tabs__link">
          Linux
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="./" class="md-tabs__link md-tabs__link--active">
          YOLO
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Socket/socket/" class="md-tabs__link">
          Socket
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../DataStructure/chain/LinkList/" class="md-tabs__link">
          DataStructure
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Skill/common_thougt/" class="md-tabs__link">
          Skill
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="PurpleCypress" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    PurpleCypress
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      简介
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        简介
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="首页" class="md-nav__link">
      首页
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      CSAPP
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        CSAPP
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSAPP/CSAPP-PartZero/" title="【考研向】计算机系统基本概念" class="md-nav__link">
      【考研向】计算机系统基本概念
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSAPP/CSAPP-PartOne-1/" title="【考研向】程序结构和执行-信息的表示和处理" class="md-nav__link">
      【考研向】程序结构和执行-信息的表示和处理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSAPP/CSAPP-PartOne-2/" title="【考研向】程序结构和执行-程序的机器级表示" class="md-nav__link">
      【考研向】程序结构和执行-程序的机器级表示
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSAPP/CSAPP-PartTwo/" title="【考研向】在系统上运行程序" class="md-nav__link">
      【考研向】在系统上运行程序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSAPP/CSAPP-PartThree/" title="【考研向】程序间的交互和通信" class="md-nav__link">
      【考研向】程序间的交互和通信
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Computer Network
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Computer Network
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Network/ComputerNetwork/" title="工大计网" class="md-nav__link">
      工大计网
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      English
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        English
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../English/speaking/" title="Speaking" class="md-nav__link">
      Speaking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../English/writing/" title="Writing" class="md-nav__link">
      Writing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../English/listening/" title="Listening" class="md-nav__link">
      Listening
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../English/reading/" title="Reading" class="md-nav__link">
      Reading
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../English/reading-hw5-a/" title="Reading-Homework5-1" class="md-nav__link">
      Reading-Homework5-1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../English/reading-hw5-b/" title="Reading-Homework5-2" class="md-nav__link">
      Reading-Homework5-2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../English/reading-hw6/" title="Reading-Homework6" class="md-nav__link">
      Reading-Homework6
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../English/reading-hw7/" title="Reading-Homework7" class="md-nav__link">
      Reading-Homework7
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Forensics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Forensics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Forensics/image/" title="数字图像取证" class="md-nav__link">
      数字图像取证
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Linux/Linux/" title="嵌入式计算机系统实验自救手册" class="md-nav__link">
      嵌入式计算机系统实验自救手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Linux/Linux_Corresponence_Windows/" title="Linux与Windows文件交互" class="md-nav__link">
      Linux与Windows文件交互
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      YOLO
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        YOLO
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        yolo原理
      </label>
    
    <a href="./" title="yolo原理" class="md-nav__link md-nav__link--active">
      yolo原理
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#yolo" class="md-nav__link">
    YOLO学习笔记
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1yolo-v1" class="md-nav__link">
    1.yolo v1
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1 基本思想：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2 损失函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3 局限性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2yolo-v2yolo9000" class="md-nav__link">
    2.yolo v2(YOLO9000)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    2.1 改进
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2 网络结构
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3yolo-v3" class="md-nav__link">
    3.yolo v3
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-backbone-darknet53" class="md-nav__link">
    3.1  backbone 结构( darknet53 )
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2 模型结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3 目标边界框的预测与正负样本匹配
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4 损失函数
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#341" class="md-nav__link">
    3.4.1 目标置信度损失（二值交叉熵）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#342" class="md-nav__link">
    3.4.2 目标类别损失（二值交叉熵）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#343" class="md-nav__link">
    3.4.3 目标定位损失
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-yolov3-spp" class="md-nav__link">
    3.5 yolov3 SPP
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#351-mosaic" class="md-nav__link">
    3.5.1 Mosaic 图像增强
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#352-spp" class="md-nav__link">
    3.5.2 SPP模块
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#353-giou-loss" class="md-nav__link">
    3.5.3 损失函数的进化：GIoU Loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#354-focal-loss" class="md-nav__link">
    3.5.4 应对正负样本数量不平衡： Focal Loss
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4yolov4" class="md-nav__link">
    4.yolov4
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1 网络结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-backbone-cspdarknet53" class="md-nav__link">
    4.2 backbone 网络(CSPDarknet53)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-tricks" class="md-nav__link">
    4.3 tricks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5yolov5" class="md-nav__link">
    5.yolov5
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    5.1 网络结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-focus" class="md-nav__link">
    5.2 Focus 结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-csp" class="md-nav__link">
    5.3 两种 CSP 结构
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../yolo_spp_code_1/" title="yolo_spp_code_学习笔记1" class="md-nav__link">
      yolo_spp_code_学习笔记1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../yolo_spp_code_2/" title="yolo_spp_code_学习笔记2" class="md-nav__link">
      yolo_spp_code_学习笔记2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Socket
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Socket
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Socket/socket/" title="socket基础" class="md-nav__link">
      socket基础
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      DataStructure
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        DataStructure
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-1" type="checkbox" id="nav-9-1">
    
    <label class="md-nav__link" for="nav-9-1">
      chain
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-1">
        chain
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/chain/LinkList/" title="链表" class="md-nav__link">
      链表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/chain/STL/" title="STL" class="md-nav__link">
      STL
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-2" type="checkbox" id="nav-9-2">
    
    <label class="md-nav__link" for="nav-9-2">
      graph
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-2">
        graph
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/graph/bipartite/" title="二分图" class="md-nav__link">
      二分图
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/graph/GenerateTree/" title="生成树" class="md-nav__link">
      生成树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/graph/netstream/" title="网络流" class="md-nav__link">
      网络流
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/graph/ShortestRoad/" title="最短路" class="md-nav__link">
      最短路
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/graph/tarjan/" title="tarjan" class="md-nav__link">
      tarjan
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-3" type="checkbox" id="nav-9-3">
    
    <label class="md-nav__link" for="nav-9-3">
      tree
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-3">
        tree
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/tree/binary_tree/" title="二叉树" class="md-nav__link">
      二叉树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/tree/DiameterOfTree/" title="树的直径" class="md-nav__link">
      树的直径
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/tree/lca/" title="最近公共祖先" class="md-nav__link">
      最近公共祖先
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/tree/modui/" title="莫队算法" class="md-nav__link">
      莫队算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/tree/PointDivide/" title="点分治" class="md-nav__link">
      点分治
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/tree/segopration/" title="线段树" class="md-nav__link">
      线段树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/tree/treearray/" title="树状数组" class="md-nav__link">
      树状数组
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../DataStructure/tree/treediff/" title="树上差分" class="md-nav__link">
      树上差分
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Skill
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Skill
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Skill/common_thougt/" title="常用思维" class="md-nav__link">
      常用思维
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Skill/DramaticProgramme/" title="动态规划" class="md-nav__link">
      动态规划
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Skill/sort/" title="排序" class="md-nav__link">
      排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Skill/string/" title="字符串" class="md-nav__link">
      字符串
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#yolo" class="md-nav__link">
    YOLO学习笔记
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1yolo-v1" class="md-nav__link">
    1.yolo v1
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1 基本思想：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2 损失函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3 局限性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2yolo-v2yolo9000" class="md-nav__link">
    2.yolo v2(YOLO9000)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    2.1 改进
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2 网络结构
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3yolo-v3" class="md-nav__link">
    3.yolo v3
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-backbone-darknet53" class="md-nav__link">
    3.1  backbone 结构( darknet53 )
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2 模型结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3 目标边界框的预测与正负样本匹配
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4 损失函数
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#341" class="md-nav__link">
    3.4.1 目标置信度损失（二值交叉熵）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#342" class="md-nav__link">
    3.4.2 目标类别损失（二值交叉熵）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#343" class="md-nav__link">
    3.4.3 目标定位损失
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-yolov3-spp" class="md-nav__link">
    3.5 yolov3 SPP
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#351-mosaic" class="md-nav__link">
    3.5.1 Mosaic 图像增强
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#352-spp" class="md-nav__link">
    3.5.2 SPP模块
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#353-giou-loss" class="md-nav__link">
    3.5.3 损失函数的进化：GIoU Loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#354-focal-loss" class="md-nav__link">
    3.5.4 应对正负样本数量不平衡： Focal Loss
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4yolov4" class="md-nav__link">
    4.yolov4
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1 网络结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-backbone-cspdarknet53" class="md-nav__link">
    4.2 backbone 网络(CSPDarknet53)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-tricks" class="md-nav__link">
    4.3 tricks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5yolov5" class="md-nav__link">
    5.yolov5
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    5.1 网络结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-focus" class="md-nav__link">
    5.2 Focus 结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-csp" class="md-nav__link">
    5.3 两种 CSP 结构
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>yolo原理</h1>
                
                <!-- <img src=".\pic\say_yolo_again.png"> -->
<p><img alt="" src="../pic/say_yolo_again.png" /></p>
<h2 id="yolo">YOLO学习笔记<a class="headerlink" href="#yolo" title="Permanent link">&para;</a></h2>
<h3 id="1yolo-v1">1.yolo v1<a class="headerlink" href="#1yolo-v1" title="Permanent link">&para;</a></h3>
<blockquote>
<p>论文来源：2016CVPR
You Only Look Once:Unified,Real-Time Object Detection
<a href="https://pjreddie.com/darknet/yolo/">参考网站</a></p>
</blockquote>
<h4 id="11">1.1 基本思想：<a class="headerlink" href="#11" title="Permanent link">&para;</a></h4>
<p>(1)将一幅图像分成 <span><span class="MathJax_Preview">S \times S</span><script type="math/tex">S \times S</script></span> 个网格(grid cell)，如果某个 object 的中心落在网格之中，则这个网格就负责预测这个 object 。</p>
<p>(2)每个网格预测 <strong>B</strong> 个 bounding box ，每个 bouding box 除了要预测位置 <code>(x,y,w,h)</code> 外，还要附带一个 <code>confidence</code> 值（ yolo 独有， Faster-RCNN 和 SSD 没有），同时还要预测 <strong>C</strong> 个类别的分数。</p>
<blockquote>
<p>eg.Pascal VOC:Our Fianl Prediction is a 7 * 7 * 30 tensor.
S = 7 ( grid cell 为 7 * 7 )
B = 2 ( 2 个 bounding box ,每个包含 x , y , w , h , confidence )
C = 20 ( classes_num = 20 )
7 * 7 * (2 * 5 + 20) -&gt; 7 * 7 * 30</p>
</blockquote>
<!-- <img src=".\pic\yolov1_cell.png"> -->
<p><img alt="" src="../pic/yolov1_cell.png" /></p>
<blockquote>
<p>每个 bouding box 的坐标是相对值，取值在[0,1]
x,y : the center of the box <strong>relative to the bounds of the grid cell</strong>
w,h : the width and height <strong>relative to the whole image</strong>
confidence : <span><span class="MathJax_Preview">Pr(Object) \times IOU_{pred}^{truth}</span><script type="math/tex">Pr(Object) \times IOU_{pred}^{truth}</script></span> ,前者为 0 或 1 ，后者为预测框和实际框的交并比</p>
</blockquote>
<p>(3)网络结构： ImageNet</p>
<p>yolov1 的网络结构并不复杂，如下图所示</p>
<p><code>其中 s 为步距 stride 的简写，未写的默认为 1</code></p>
<!-- <img src=".\pic\yolov1_net.png"> -->
<p><img alt="" src="../pic/yolov1_net.png" /></p>
<p>最后两层： 4096 -&gt; 1470 -&gt;( reshape 处理) 7  * 7 * 30  （即上述的 cell 结构）</p>
<p>(4) 激活函数： leaky ReLU</p>
<p><img alt="" src="../pic/three_relu.png" /></p>
<p>PReLu 的 <span><span class="MathJax_Preview">a_i</span><script type="math/tex">a_i</script></span> 是根据数据变化的
LeakyReLu 的 <span><span class="MathJax_Preview">a_i</span><script type="math/tex">a_i</script></span> 是固定的
RReLu 的 <span><span class="MathJax_Preview">a_{ji}</span><script type="math/tex">a_{ji}</script></span> 是一个给定范围随机抽取的值 </p>
<h4 id="12">1.2 损失函数<a class="headerlink" href="#12" title="Permanent link">&para;</a></h4>
<blockquote>
<p>yolov1 的损失函数由三部分组成,所用方法为误差平方和
(1) bouding box loss
(2) confidence loss
(3) classes loss</p>
</blockquote>
<!-- <img src=".\pic\yolov1_lossfuction.png"> -->
<p><img alt="" src="../pic/yolov1_lossfuction.png" /></p>
<p><mark>tips:</mark></p>
<p>(1) bouding box 损失中的宽高损失计算需要<strong>开根号</strong>，目的是<strong>防止不同尺寸的目标框偏移相同距离时的 loss 值一样</strong>（偏移相同的距离，对于大目标而言， IoU 较大，则loss值应该相对较低；对于小目标而言， IoU 较小，则loss值应该相对较高，故采用开根可以起到如此效果）</p>
<!-- <img src=".\pic\yolov1_boundingboxloss.png"> -->
<p><img alt="" src="../pic/yolov1_boundingboxloss.png" /></p>
<p>(2) confidence 损失计算中分为正样本和负样本的计算，根据正负样本真实值 <span><span class="MathJax_Preview">{C_i}</span><script type="math/tex">{C_i}</script></span> 取 1 或 0 </p>
<p>(3) <span><span class="MathJax_Preview">\lambda</span><script type="math/tex">\lambda</script></span> 为损失函数的权重 loss weight
* 8 维的 localization error 和 20 维的 classes error 相比，前者的权重需要大些才合理，即对坐标赋予更大的 loss weight
*  如果一个网格中没有 object（一幅图中这种网格很多），那么就会将这些网格中的 box 的 confidence push到0，相比于较少的有 object 的网格，这种做法是 overpowering 的，这会导致网络不稳定甚至发散。对没有 object 的 box 的 confidence loss，赋予小的 loss weight
*  有 object 的 box 的 confidence loss 和类别的 loss 的loss weight正常取 1</p>
<p>(4) 只有当某个网格中有 object 的时候才对 classification error 进行惩罚;只有当某个 box predictor 对某个 ground truth box 负责的时候，才会对 box 的 coordinate error 进行惩罚，而对哪个 ground truth box 负责就看其预测值和 ground truth box 的 IoU 是不是在那个 cell 的所有 box 中最大(NMS)。</p>
<h4 id="13">1.3 局限性<a class="headerlink" href="#13" title="Permanent link">&para;</a></h4>
<p>(1) 群体性目标难预测，例如一群飞鸟，不适合密集性对象（一个 grid 一个类）</p>
<p>(2) 当目标出现新的尺寸或配置时，预测性能较差</p>
<p>(3) 定位不准确是主要问题（缺少 anchor 先验框 ）</p>
<h3 id="2yolo-v2yolo9000">2.yolo v2(YOLO9000)<a class="headerlink" href="#2yolo-v2yolo9000" title="Permanent link">&para;</a></h3>
<blockquote>
<p>论文来源：2017CVPR 
YOLO9000:Better,Faster,Stronger
<a href="http://pjreddie.com/yolo9000/">参考网站</a></p>
</blockquote>
<h4 id="21">2.1 改进<a class="headerlink" href="#21" title="Permanent link">&para;</a></h4>
<p>(1) Batch Normalization : 在每个卷积层后都增加了BN层</p>
<ul>
<li>更好收敛（每层输入数据分布稳定在梯度非饱和区，加快学习速度，防止梯度消失）</li>
<li>减少其他形式的正则化处理</li>
<li>可以替代 dropout 操作（防止过拟合）</li>
</ul>
<p>(2) High Resolution Classifier : 224 * 224 -&gt; 448 * 448</p>
<p>(3) Convolutinal With Anchor Boxes ：小幅度降低了 mAP ，但大幅提升了召回率（查全率）
预测偏移量比预测坐标值(yolov1)更能简化工作</p>
<p>(4) Dimention Cluster : 基于训练集采用 k-means 聚类的方法得到 anchor(priors) </p>
<p>(5) Direct Location prediction : 使每个 anchor(prior) 去预测目标中心落在某个 grid cell 区域内的目标(防止加上预测偏移量会导致建议框出现在图片任意一个地方)，网络更易于学习和更加稳定</p>
<p><img alt="" src="../pic/yolov2_anchor_pr.png" /></p>
<ul>
<li><span><span class="MathJax_Preview">b_x,b_y,b_w,b_h</span><script type="math/tex">b_x,b_y,b_w,b_h</script></span> 是预测框的中心和宽高， <span><span class="MathJax_Preview">Pr(object)*IOU(b,object)</span><script type="math/tex">Pr(object)*IOU(b,object)</script></span> 是预测框的置信度，这里对预测参数 <span><span class="MathJax_Preview">t_o</span><script type="math/tex">t_o</script></span> 进行 <span><span class="MathJax_Preview">\sigma</span><script type="math/tex">\sigma</script></span> 变换后作为置信度的值</li>
<li><span><span class="MathJax_Preview">c_x,c_y</span><script type="math/tex">c_x,c_y</script></span> 是当前网格左上角到图像左上角的距离，要先对一个网格大小归一化</li>
<li><span><span class="MathJax_Preview">p_w,p_h</span><script type="math/tex">p_w,p_h</script></span> 是先验框的宽和高</li>
<li><span><span class="MathJax_Preview">\sigma</span><script type="math/tex">\sigma</script></span> 是 sigmoid 函数</li>
<li><span><span class="MathJax_Preview">t_x,t_y,t_w,t_h,t_o</span><script type="math/tex">t_x,t_y,t_w,t_h,t_o</script></span> 是要学习的参数，分别用于预测边框的中心宽高和置信度</li>
</ul>
<p>(6) Fine-Grained Features : 对于小目标的预测，同时融合了高层和低层的特征层，增加了 <strong>passthrough layer</strong> 的处理</p>
<p>(7) Multi-Scale Training ：每迭代 10 个 batch ，就改变输入尺寸的大小，尺寸均为 32 的整数倍，范围在{320,352，……,608}</p>
<h4 id="22">2.2 网络结构<a class="headerlink" href="#22" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../pic/yolov2_net.png" /></p>
<ul>
<li>图中的每个 convolutional 都是由<code>卷积层(Conv2D)、 BN 层、激活函数(LeakyReLU)</code>组成，最后一层只有一个单卷积层作为预测器</li>
<li>Size 中未标步距的默认为 1 </li>
<li>backbone 中的 Darknet19 (由 19 个卷积层) 移除了最后一层卷积层及其之后的层，后面添加了 3 个 <code>3 * 3 的 1024 核卷积层</code></li>
<li>最后预测的 125 个参数即为 5 个 boundingbox ，其中包括 <code>x , y , w , h , confidence</code>,以及 <code>20 个类别</code></li>
<li>PassThrough Layer 作为高低层的特征层融合途径（防止小目标在高层没被提取出来），其中 26 * 26 * 64 变成 13 * 13 * 256 的原理如下图所示</li>
</ul>
<p><img alt="" src="../pic/yolov2_passthroughlayer.png" /></p>
<h3 id="3yolo-v3">3.yolo v3<a class="headerlink" href="#3yolo-v3" title="Permanent link">&para;</a></h3>
<blockquote>
<p>论文来源： 2018CVPR
<a href="https://arxiv.org/pdf/1804.02767.pdf">YOLOv3: An Incremental Improvement</a></p>
</blockquote>
<h4 id="31-backbone-darknet53">3.1  backbone 结构( darknet53 )<a class="headerlink" href="#31-backbone-darknet53" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../pic/yolov3_darknet53.png" /></p>
<ul>
<li>53个卷积层（包括最后的 Connnected ），其中 convolutianl 均由<code>卷积层， BN 层，激活函数(LeakyRelu)</code>组成，残差结构均为<code>主分支和捷径分支</code>的相加结构</li>
<li>没有 maxpolling 层，下采样均由卷积层处理( size 为 2 )</li>
</ul>
<h4 id="32">3.2 模型结构<a class="headerlink" href="#32" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../pic/yolov3_net.jpg" /></p>
<ul>
<li>yolov3 在 3 个特征层进行预测，每个特征层采用 3 种尺度的 bounding box priors (即 anchor ,同样基于 k-means 聚类),参数如下图所示：</li>
</ul>
<p><img alt="" src="../pic/yolov3_boundingbox_parameters.png" /></p>
<p>每个特征层的预测参数个数为 <span><span class="MathJax_Preview">N \times N \times [3 * (4 + 1 + 80)]</span><script type="math/tex">N \times N \times [3 * (4 + 1 + 80)]</script></span> ,其中 80 为种类数（ CoCo 数据集）</p>
<ul>
<li>Up Sampling 为上采样层，高和宽会扩大为原来的 2 倍，扩大后便可与原来低层的输出进行 concatenate ，即进行深度上的拼接（ 13 -&gt; 26 -&gt; 52 ）</li>
<li>特征图 1 尺寸为 13 * 13,用来预测相对较大的目标；特征图 2 尺寸为 26 * 26,用来预测大小中等的目标；特征图 3 尺寸为 52 * 52，用来预测相对较小的目标</li>
</ul>
<h4 id="33">3.3 目标边界框的预测与正负样本匹配<a class="headerlink" href="#33" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../pic/yolov3_boundingboxpredict.png" /></p>
<blockquote>
<p><span><span class="MathJax_Preview">\sigma</span><script type="math/tex">\sigma</script></span> 函数即为 sigmoid 函数，将预测的增量限制在一定范围使 anchor 不会超出对应的 grid cell </p>
</blockquote>
<p>与 ground truth 的 重合度最大的 bounding box 定为正样本，重合度不是最大但大于阈值的则忽视（不作为样本，即不计算目标框损失 loss for coordinate prediction 和类别损失 loss for class prediction ,仅计算置信度 objectness ），其余的则为负样本</p>
<h4 id="34">3.4 损失函数<a class="headerlink" href="#34" title="Permanent link">&para;</a></h4>
<blockquote>
<p>YOLOv3 的损失函数主要分为 3 个部分：目标置信度损失 <span><span class="MathJax_Preview">L_{conf}(o,c)</span><script type="math/tex">L_{conf}(o,c)</script></span> ,目标分类损失 <span><span class="MathJax_Preview">L_{cla}(O,C)</span><script type="math/tex">L_{cla}(O,C)</script></span> 和目标定位偏移量损失 <span><span class="MathJax_Preview">L_{loc}(l,g)</span><script type="math/tex">L_{loc}(l,g)</script></span> , <span><span class="MathJax_Preview">\lambda_1,\lambda_2,\lambda_3</span><script type="math/tex">\lambda_1,\lambda_2,\lambda_3</script></span> 为平衡系数
 <span><span class="MathJax_Preview">L(O,o,C,c,l,g) = \lambda_1 L_{conf}(o,c) + \lambda_2 L_{cla}(O,C) + \lambda_3 L_{loc}(l,g)</span><script type="math/tex">L(O,o,C,c,l,g) = \lambda_1 L_{conf}(o,c) + \lambda_2 L_{cla}(O,C) + \lambda_3 L_{loc}(l,g)</script></span></p>
</blockquote>
<h5 id="341">3.4.1 目标置信度损失（二值交叉熵）<a class="headerlink" href="#341" title="Permanent link">&para;</a></h5>
<blockquote>
<p><span><span class="MathJax_Preview">L_{conf}(o,c)=- \frac{\sum_i(o_i ln(\hat{c_i})+(1-o_i) ln(1-\hat{c_i}))}{N}</span><script type="math/tex">L_{conf}(o,c)=- \frac{\sum_i(o_i ln(\hat{c_i})+(1-o_i) ln(1-\hat{c_i}))}{N}</script></span>
<span><span class="MathJax_Preview">\hat{c_i}=sigmoid(c_i)</span><script type="math/tex">\hat{c_i}=sigmoid(c_i)</script></span></p>
</blockquote>
<p><span><span class="MathJax_Preview">o_i \in [0,1]</span><script type="math/tex">o_i \in [0,1]</script></span>,表示目标边界与真实边界(ground truth)的 IoU ,c 为预测值， <span><span class="MathJax_Preview">\hat{c_i}</span><script type="math/tex">\hat{c_i}</script></span> 为 c 通过 sigmoid 函数得到的预测置信度， N 为正负样本个数</p>
<h5 id="342">3.4.2 目标类别损失（二值交叉熵）<a class="headerlink" href="#342" title="Permanent link">&para;</a></h5>
<blockquote>
<p><span><span class="MathJax_Preview">L_{cla}(O,C) = - \frac{ \sum_{i \in pos} \sum_{j \in cla} (O_{ij} ln(\hat{C_{ij}}) + (1-O_{ij}) ln(1- \hat{C_{ij}}))}{N_{pos}}</span><script type="math/tex">L_{cla}(O,C) = - \frac{ \sum_{i \in pos} \sum_{j \in cla} (O_{ij} ln(\hat{C_{ij}}) + (1-O_{ij}) ln(1- \hat{C_{ij}}))}{N_{pos}}</script></span>
<span><span class="MathJax_Preview">\hat{C_{ij}}=sigmoid(C_{ij})</span><script type="math/tex">\hat{C_{ij}}=sigmoid(C_{ij})</script></span></p>
</blockquote>
<p><span><span class="MathJax_Preview">O_{ij} \in {\{0,1\}}</span><script type="math/tex">O_{ij} \in {\{0,1\}}</script></span>，表示目标边界框 i 中是否存在第 j 类目标，<span><span class="MathJax_Preview">C_{ij}</span><script type="math/tex">C_{ij}</script></span> 为目标值,<span><span class="MathJax_Preview">\hat {C_{ij}}</span><script type="math/tex">\hat {C_{ij}}</script></span> 为 <span><span class="MathJax_Preview">C_{ij}</span><script type="math/tex">C_{ij}</script></span> 通过 sigmoid 函数得到的目标概率， <span><span class="MathJax_Preview">N_{pos}</span><script type="math/tex">N_{pos}</script></span> 为正样本个数</p>
<h5 id="343">3.4.3 目标定位损失<a class="headerlink" href="#343" title="Permanent link">&para;</a></h5>
<p><img alt="" src="../pic/yolov3_boundingboxpredict.png" /></p>
<blockquote>
<p><span><span class="MathJax_Preview">L_{loc}(l,g) = \frac{ \sum_{i \in pos} \sum_{m \in \{x,y,w,h\}} (\hat{l_i^m}-\hat{g_i^m})^2}{N_{pos}}</span><script type="math/tex">L_{loc}(l,g) = \frac{ \sum_{i \in pos} \sum_{m \in \{x,y,w,h\}} (\hat{l_i^m}-\hat{g_i^m})^2}{N_{pos}}</script></span>
<span><span class="MathJax_Preview">\hat{l_i^x}=Sigmoid(t_x),\hat{l_i^y}=Sigmoid(t_y)</span><script type="math/tex">\hat{l_i^x}=Sigmoid(t_x),\hat{l_i^y}=Sigmoid(t_y)</script></span>
<span><span class="MathJax_Preview">\hat{l_i^w}=t_w,\hat{l_i^h}=t_h</span><script type="math/tex">\hat{l_i^w}=t_w,\hat{l_i^h}=t_h</script></span>
<span><span class="MathJax_Preview">\hat{g_i^x}=g_i^x-c_i^x,\hat{g_i^y}=g_i^y-c_i^y</span><script type="math/tex">\hat{g_i^x}=g_i^x-c_i^x,\hat{g_i^y}=g_i^y-c_i^y</script></span>
<span><span class="MathJax_Preview">\hat{g_i^w}=ln(g_i^w/p_i^w),\hat{g_i^h}=ln(g_i^h/p_i^h)</span><script type="math/tex">\hat{g_i^w}=ln(g_i^w/p_i^w),\hat{g_i^h}=ln(g_i^h/p_i^h)</script></span></p>
</blockquote>
<h4 id="35-yolov3-spp">3.5 yolov3 SPP<a class="headerlink" href="#35-yolov3-spp" title="Permanent link">&para;</a></h4>
<blockquote>
<p>yolov3-SPP-ultralytics 中有许多提升效能的 tricks</p>
</blockquote>
<h5 id="351-mosaic">3.5.1 Mosaic 图像增强<a class="headerlink" href="#351-mosaic" title="Permanent link">&para;</a></h5>
<p>将若干个原图像进行拼接形成新图像，增强后一张图像的信息就包含原本多张图像的信息，有助于</p>
<p>（1） 增加数据的多样性
（2） 增加目标个数
（3） BN 能一次性统计多张图片的参数</p>
<h5 id="352-spp">3.5.2 SPP模块<a class="headerlink" href="#352-spp" title="Permanent link">&para;</a></h5>
<p><img alt="" src="../pic/yolov3_spp.png" /></p>
<p>相比于原网络增加了<code>SPP 模块</code>（在原网络中的 convolutianal set 插入），包含 3 路最大池化层，将 4 路特征进行 concatenate 拼接(512-&gt;2048)</p>
<h5 id="353-giou-loss">3.5.3 损失函数的进化：GIoU Loss<a class="headerlink" href="#353-giou-loss" title="Permanent link">&para;</a></h5>
<p>(1) l2 :原 yolov3 采用的目标定位损失为 l2 损失</p>
<blockquote>
<p><span><span class="MathJax_Preview">L_{loc}(l,g) = \frac{ \sum_{i \in pos} \sum_{m \in \{x,y,w,h\}} (\hat{l_i^m}-\hat{g_i^m})^2}{N_{pos}}</span><script type="math/tex">L_{loc}(l,g) = \frac{ \sum_{i \in pos} \sum_{m \in \{x,y,w,h\}} (\hat{l_i^m}-\hat{g_i^m})^2}{N_{pos}}</script></span>
<span><span class="MathJax_Preview">\hat{l_i^x}=Sigmoid(t_x),\hat{l_i^y}=Sigmoid(t_y)</span><script type="math/tex">\hat{l_i^x}=Sigmoid(t_x),\hat{l_i^y}=Sigmoid(t_y)</script></span>
<span><span class="MathJax_Preview">\hat{l_i^w}=t_w,\hat{l_i^h}=t_h</span><script type="math/tex">\hat{l_i^w}=t_w,\hat{l_i^h}=t_h</script></span>
<span><span class="MathJax_Preview">\hat{g_i^x}=g_i^x-c_i^x,\hat{g_i^y}=g_i^y-c_i^y</span><script type="math/tex">\hat{g_i^x}=g_i^x-c_i^x,\hat{g_i^y}=g_i^y-c_i^y</script></span>
<span><span class="MathJax_Preview">\hat{g_i^w}=ln(g_i^w/p_i^w),\hat{g_i^h}=ln(g_i^h/p_i^h)</span><script type="math/tex">\hat{g_i^w}=ln(g_i^w/p_i^w),\hat{g_i^h}=ln(g_i^h/p_i^h)</script></span></p>
</blockquote>
<p>会出现损失相同但 IoU 差距明显的的情况</p>
<p><img alt="" src="../pic/yolov3_l2same.png" /></p>
<p>(2) IoU Loss = -ln IoU 或者 IoU Loss = 1 - IoU</p>
<p>能够更好地反应重合程度，具有尺度不变性，但当不相交时 loss 为 0 ，不符合实际情况</p>
<p>(3) GIoU Loss = 1 - GIoU</p>
<p><span><span class="MathJax_Preview">GIoU = IoU - \frac{A^c-U}{A^c}</span><script type="math/tex">GIoU = IoU - \frac{A^c-U}{A^c}</script></span>
<span><span class="MathJax_Preview">-1 \leq GIoU \leq 1</span><script type="math/tex">-1 \leq GIoU \leq 1</script></span>
<span><span class="MathJax_Preview">0 \leq GIoU Loss \leq 2</span><script type="math/tex">0 \leq GIoU Loss \leq 2</script></span></p>
<p><img alt="" src="../pic/yolov3_GIoU.png" /></p>
<p>其中，绿色矩形框为 ground truth ,红色矩形框预测框，蓝色矩形框为同时包含它们的最小矩形框， <span><span class="MathJax_Preview">A^c</span><script type="math/tex">A^c</script></span> 则为蓝色矩形框面积。<code>当其重合时， GIoU = 1 ；当其相距无穷远时， GIoU = -1</code></p>
<p>(4) DIoU Loss = 1 - DIoU
<span><span class="MathJax_Preview">DIoU = IoU -\frac{\rho^2(b,b^{gt})}{c^2} = IoU - \frac{d^2}{c^2}</span><script type="math/tex">DIoU = IoU -\frac{\rho^2(b,b^{gt})}{c^2} = IoU - \frac{d^2}{c^2}</script></span>
$-1 \leq DIoU \leq 1 $
<span><span class="MathJax_Preview">0 \leq DIoU Loss \leq 2</span><script type="math/tex">0 \leq DIoU Loss \leq 2</script></span></p>
<p><img alt="" src="../pic/yolov3_DIoU.png" /></p>
<p>其中，<span><span class="MathJax_Preview">\rho^2(b,b^{gt})</span><script type="math/tex">\rho^2(b,b^{gt})</script></span> 即为预测框和 grounding box 中心点的欧氏距离 d ,  c 则为包含这两个框的最小矩形框的对角线长度。<code>DIoU损失能够直接最小化两个 boxes 之间的距离，因此收敛速度更快</code></p>
<p>(5) CIoU Loss = 1 - CIoU
<span><span class="MathJax_Preview">CIoU = IoU - (\frac{\rho^2(b,b^{gt})}{c^2}+\alpha \upsilon)</span><script type="math/tex">CIoU = IoU - (\frac{\rho^2(b,b^{gt})}{c^2}+\alpha \upsilon)</script></span>
<span><span class="MathJax_Preview">\upsilon = \frac{4}{\pi^2}(\arctan \frac{w^{gt}}{h^{gt}}-\arctan \frac{w}{h})^2</span><script type="math/tex">\upsilon = \frac{4}{\pi^2}(\arctan \frac{w^{gt}}{h^{gt}}-\arctan \frac{w}{h})^2</script></span>
<span><span class="MathJax_Preview">\alpha = \frac{\upsilon}{(1-IoU)+\upsilon}</span><script type="math/tex">\alpha = \frac{\upsilon}{(1-IoU)+\upsilon}</script></span></p>
<blockquote>
<p>一个优秀的回归定位损失应该考虑到 3 种几何参数：
重叠面积 中心点距离 长宽比</p>
</blockquote>
<h5 id="354-focal-loss">3.5.4 应对正负样本数量不平衡： Focal Loss<a class="headerlink" href="#354-focal-loss" title="Permanent link">&para;</a></h5>
<p>(1) 对于普通的交叉熵损失（二分类）CE (cross entropy) 而言：</p>
<div>
<div class="MathJax_Preview"> CE(p,y)  =\begin{cases}
-ln(p) &amp; y = 1 \\
-ln(1-p) &amp; otherwise \\
\end{cases}</div>
<script type="math/tex; mode=display"> CE(p,y)  =\begin{cases}
-ln(p) & y = 1 \\
-ln(1-p) & otherwise \\
\end{cases}</script>
</div>
<p>或</p>
<div>
<div class="MathJax_Preview"> p_t = \begin{cases}
p &amp; y =1 \\
1 - p &amp; otherwise \\
\end{cases} </div>
<script type="math/tex; mode=display"> p_t = \begin{cases}
p & y =1 \\
1 - p & otherwise \\
\end{cases} </script>
</div>
<p><span><span class="MathJax_Preview">CE(p,y)=CE(p_t)=-ln(p_t)</span><script type="math/tex">CE(p,y)=CE(p_t)=-ln(p_t)</script></span></p>
<p>(2) 引入平衡因子(Balanced Cross Entropy)</p>
<p><span><span class="MathJax_Preview">CE(p_t)=-\alpha_t ln(p_t)</span><script type="math/tex">CE(p_t)=-\alpha_t ln(p_t)</script></span></p>
<p><span><span class="MathJax_Preview">\alpha</span><script type="math/tex">\alpha</script></span>为用于平衡正负样本的超参数</p>
<p>(3) 加入可以区分难易样本的参数</p>
<p><span><span class="MathJax_Preview">FL(p_t)=-(1-p_t)^\gamma log(p_t)</span><script type="math/tex">FL(p_t)=-(1-p_t)^\gamma log(p_t)</script></span></p>
<p><span><span class="MathJax_Preview">(1-p_t)^\gamma</span><script type="math/tex">(1-p_t)^\gamma</script></span> 能够降低易分样本的损失贡献，使得模型专注训练复杂样本</p>
<p>(4) 结合超参数</p>
<p><span><span class="MathJax_Preview">FL(p_t) = -\alpha_t(1-p_t)^\gamma ln(p_t)</span><script type="math/tex">FL(p_t) = -\alpha_t(1-p_t)^\gamma ln(p_t)</script></span></p>
<p>即</p>
<div>
<div class="MathJax_Preview">FL(p)=\begin{cases}
-\alpha (1-p)^\gamma ln(p) &amp; y = 1 \\
-(1-\alpha)p^\gamma ln(1-p) &amp; otherwise \\
\end{cases}</div>
<script type="math/tex; mode=display">FL(p)=\begin{cases}
-\alpha (1-p)^\gamma ln(p) & y = 1 \\
-(1-\alpha)p^\gamma ln(1-p) & otherwise \\
\end{cases}</script>
</div>
<p><img alt="" src="../pic/yolov3_focalloss.png" /></p>
<p>由数据可知，对于简单样本 Focal Loss 相比于 CE 降低了简单样本的损失贡献率，使得模型更好地训练难学习样本</p>
<p><mark>FocalLoss 易受噪声干扰，在使用过程中需要进行调参，同时也要保证数据集的标注精准度，否则也会使效果下降</mark></p>
<h3 id="4yolov4">4.yolov4<a class="headerlink" href="#4yolov4" title="Permanent link">&para;</a></h3>
<blockquote>
<p><a href="https://arxiv.org/pdf/2004.10934.pdf">Yolov4: Optimal Speed and Accuracy of Object Detection</a></p>
</blockquote>
<h4 id="41">4.1 网络结构<a class="headerlink" href="#41" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../pic/yolov4_backbone.png" /></p>
<ul>
<li>基础仍是 yolov3 网络，backbone 为 CSPDarknet53 ，Resblock 为残差结构</li>
<li>SPP 通过 4 个不同尺度的最大池化对输入的特征层进行池化后拼接，大小分别为 <code>13 * 13</code> <code>9 * 9</code> <code>5 * 5</code> <code>1 * 1</code></li>
<li>PA Net 与 yolov3 的增强网络类似（特征金字塔结构： FPN + PAN），通过卷积和上采样(FPN:13-&gt;26-&gt;52)进行对应层的拼接，之后再进行卷积和下采样(PAN：52-&gt;26-&gt;13)进行对应层拼接<code>不断上下采样通道堆叠得到更好的特征，对 3 个有效特征层进行特征的反复提取</code></li>
<li>YOLO Head 和 yolov3 的三个预测层相同(N * N * 3 * (5 + 70))</li>
</ul>
<h4 id="42-backbone-cspdarknet53">4.2 backbone 网络(CSPDarknet53)<a class="headerlink" href="#42-backbone-cspdarknet53" title="Permanent link">&para;</a></h4>
<p>相比于 yolov3 ,其改进的地方有：</p>
<p>(1) 激活函数： LeakyReLU -&gt; Mish</p>
<p>convolutional 结构变为 <code>darknetConv2D</code> <code>BN</code> <code>Mish</code></p>
<p>Mish 函数： <span><span class="MathJax_Preview">Mish = x \times tanh(ln(1+e^x))</span><script type="math/tex">Mish = x \times tanh(ln(1+e^x))</script></span></p>
<p>其图像为：</p>
<p><img alt="" src="../pic/yolov4_Mish.png" /></p>
<p>(2) 残差结构使用了 CSPnet 结构</p>
<p><img alt="" src="../pic/yolov4_cspnet.png" /></p>
<p>CSP net 将原来残差快的堆叠进行了一个拆分，主干部分不变，另一个部分经过少量处理连接到最后，即多了一条绕过了很多残差结构的大残差边</p>
<h4 id="43-tricks">4.3 tricks<a class="headerlink" href="#43-tricks" title="Permanent link">&para;</a></h4>
<p>(1) 在预测结构中，yolov4 的方法是：
* 取出每一类得分大于阈值的目标框和得分
* 利用框的位置和得分进行非极大值抑制</p>
<p>(2) Mosaic 数据增强</p>
<p>同 yolov3_SPP 处理，一次对 4 张图片的信息进行组合</p>
<p>(3) Label Smoothing 平滑</p>
<p><code>new_onehot_labels = onehot_labels * (1 - label_smoothing) + label_smoothing / num_classes</code></p>
<p>标签(0,1) -&gt; 平滑(0.005,0.995)</p>
<p>(4) 损失函数引入 CIoU ，同 yolov3_SPP</p>
<p>(5) 学习率余弦退火衰减</p>
<p><img alt="" src="../pic/yolov4_warmup.png" /></p>
<h3 id="5yolov5">5.yolov5<a class="headerlink" href="#5yolov5" title="Permanent link">&para;</a></h3>
<h4 id="51">5.1 网络结构<a class="headerlink" href="#51" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../pic/yolov5_net.png" /></p>
<h4 id="52-focus">5.2 Focus 结构<a class="headerlink" href="#52-focus" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../pic/yolov5_focus.png" /></p>
<p>4 * 4 * 3  -&gt;   2 * 2 * 12</p>
<h4 id="53-csp">5.3 两种 CSP 结构<a class="headerlink" href="#53-csp" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../pic/yolov5_csp.png" /></p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../Linux/Linux_Corresponence_Windows/" title="Linux与Windows文件交互" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                Linux与Windows文件交互
              </span>
            </div>
          </a>
        
        
          <a href="../yolo_spp_code_1/" title="yolo_spp_code_学习笔记1" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  下一页
                </span>
                yolo_spp_code_学习笔记1
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/purplezi" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.1.2",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
      
        <script src="https://unpkg.com/mermaid@8.0.0-rc.8/dist/mermaid.min.js"></script>
      
    
  </body>
</html>